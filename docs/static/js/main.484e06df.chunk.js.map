{"version":3,"sources":["App.module.scss","audios.js","reducer.js","App.js","index.js"],"names":["module","exports","audios","djembe1","Audio","djembe2","djembe3","query","decodeURI","window","location","search","substr","initialState","playRow","signature","track","signatureToTrack","Array","fill","map","item","trackToSignature","forEach","row","normalizedSignature","toLowerCase","replace","length","index","MAP","onLengthChange","state","action","payload","newTrack","onCellClick","rowIndex","cellIndex","onPlayNext","instrument","realPlayRow","findIndex","audio","volume","currentTime","play","onSignatureChange","value","reducer","type","audioContextClass","AudioContext","webkitAudioContext","App","useReducer","dispatch","useState","playing","setPlaying","temp","setTemp","Object","keys","setInstrument","onTempChangeHandler","useCallback","event","target","Number","isNaN","Math","round","onInstrumentChangeHandler","onSignatureChangeHandler","onDoubleTempHandler","onHalfTempHandler","onLengthChangeHandler","onCellClickHandler","getAttribute","onPlayClick","load","pause","onStopClick","activeRowIndex","useMemo","useEffect","intervalId","setInterval","onPlayNextAction","clearInterval","className","cn","root","table","header","annotation","active","key","inactive","cell","data-row-index","data-cell-index","inner","onClick","input","onChange","name","button","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.484e06df.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"App_root__2CSG3\",\"input\":\"App_input__13lVr\",\"button\":\"App_button__z3Rot\",\"table\":\"App_table__1ESJA\",\"header\":\"App_header__2L3DO\",\"annotation\":\"App_annotation__3-Cgl\",\"row\":\"App_row__3uKGE\",\"active\":\"App_active__2jQ78\",\"cell\":\"App_cell__2E5fJ\",\"inner\":\"App_inner__KKynl\"};","export const audios = {\n  djembe1: [new Audio('mp3/b1.mp3'), new Audio('mp3/t1.mp3'), new Audio('mp3/s1.mp3')],\n  djembe2: [new Audio('mp3/b2.mp3'), new Audio('mp3/t2.mp3'), new Audio('mp3/s2.mp3')],\n  djembe3: [new Audio('mp3/b3.mp3'), new Audio('mp3/t3.mp3'), new Audio('mp3/s3.mp3')],\n}\n","import { audios } from './audios'\n\nconst query = decodeURI(window.location.search.substr(1))\n\nexport const initialState = !query\n  ? {\n      playRow: 0,\n      signature: '--------',\n      track: Array(8)\n        .fill(null)\n        .map((item) => Array(3).fill(false)),\n    }\n  : {\n      playRow: 0,\n      signature: query,\n      track: signatureToTrack(query),\n    }\n\nconst onLengthChange = (state, action) => {\n  const { length } = action.payload\n  const newTrack = Array(length)\n    .fill(null)\n    .map((item, index) => {\n      return state.track[index] || Array(3).fill(false)\n    })\n\n  return {\n    ...state,\n    track: newTrack,\n    signature: trackToSignature(newTrack),\n  }\n}\n\nfunction trackToSignature(track) {\n  let signature = ''\n  track.forEach(function(row) {\n    if (row[0]) signature += 'B'\n    else if (row[1]) signature += 't'\n    else if (row[2]) signature += 'S'\n    else signature += '-'\n  })\n  return signature\n}\n\nfunction signatureToTrack(signature) {\n  const normalizedSignature = signature.toLowerCase().replace(/\\s/g, '')\n  return Array(normalizedSignature.length)\n    .fill(null)\n    .map((item, index) => {\n      const row = Array(3).fill(false)\n      switch (normalizedSignature[index]) {\n        case 'b':\n          row[0] = true\n          break\n        case 't':\n          row[1] = true\n          break\n        case 's':\n          row[2] = true\n          break\n        default:\n          break\n      }\n      return row\n    })\n}\n\nconst onSignatureChange = (state, action) => {\n  const signature = action.payload.signature.value\n\n  const newTrack = signatureToTrack(signature)\n\n  return {\n    ...state,\n    signature: signature,\n    track: newTrack,\n  }\n}\n\nconst onCellClick = (state, action) => {\n  const { rowIndex, cellIndex } = action.payload\n\n  const newTrack = state.track.map((item, index) => {\n    return rowIndex !== index\n      ? item\n      : item.map((item, index) => {\n          return index !== cellIndex ? false : !item\n        })\n  })\n\n  return {\n    ...state,\n    track: newTrack,\n    signature: trackToSignature(newTrack),\n  }\n}\n\nconst onPlayNext = (state, action) => {\n  const { playRow, track } = state\n  const { instrument } = action.payload\n\n  if (!track.length) return { ...state, playRow: 0 }\n\n  const realPlayRow = track[playRow] ? playRow : 0\n\n  // audios.forEach((audio) => {\n  //   audio.pause()\n  //   audio.currentTime = 0\n  // })\n\n  const cellIndex = track[realPlayRow].findIndex((item) => item)\n\n  if (cellIndex > -1) {\n    let audio = audios[instrument][cellIndex]\n    audio.volume = 1 // reset Audio volume after \"silent\" play in user click\n    audio.currentTime = 0 // reset Audio play time\n    audio.play()\n  }\n\n  return {\n    ...state,\n    playRow: track[realPlayRow + 1] ? realPlayRow + 1 : 0,\n  }\n}\n\nconst MAP = {\n  onLengthChange,\n  onCellClick,\n  onPlayNext,\n  onSignatureChange,\n}\n\nexport const reducer = (state, action) => {\n  return MAP[action.type](state, action)\n}\n\nexport const onLengthChangeAction = (length) => ({\n  type: 'onLengthChange',\n  payload: {\n    length,\n  },\n})\n\nexport const onSignatureChangeAction = (signature) => ({\n  type: 'onSignatureChange',\n  payload: {\n    signature,\n  },\n})\n\nexport const onCellClickAction = ({ rowIndex, cellIndex }) => ({\n  type: 'onCellClick',\n  payload: {\n    rowIndex,\n    cellIndex,\n  },\n})\n\nexport const onPlayNextAction = (instrument) => ({\n  type: 'onPlayNext',\n  payload: {\n    instrument,\n  },\n})\n","import React, { useCallback, useReducer, useState, useEffect, useMemo } from 'react'\nimport {\n  reducer,\n  initialState,\n  onLengthChangeAction,\n  onCellClickAction,\n  onSignatureChangeAction,\n} from './reducer'\nimport { onPlayNextAction } from './reducer'\n\nimport cn from './App.module.scss'\nimport { audios } from './audios'\n\n// These two lines are required for Safari to cache audio and play it without a lag\nconst audioContextClass = window.AudioContext || window.webkitAudioContext\n// eslint-disable-next-line \nconst audioContext = audioContextClass ? new audioContextClass() : null\n\nconst App = () => {\n  const [state, dispatch] = useReducer(reducer, initialState)\n  const [playing, setPlaying] = useState(false)\n  const [temp, setTemp] = useState(150)\n  const [instrument, setInstrument] = useState(Object.keys(audios)[0])\n\n  const onTempChangeHandler = useCallback((event) => {\n    const value = +event.target.value\n    if (Number.isNaN(value) || value < 0) return\n    setTemp(Math.round(value))\n  }, [])\n\n  const onInstrumentChangeHandler = useCallback((event) => {\n    const value = event.target.value\n    setInstrument(value)\n  }, [])\n\n  const onSignatureChangeHandler = useCallback((event) => {\n    const value = event.target.value\n    dispatch(onSignatureChangeAction({ value }))\n  }, [])\n\n  const onDoubleTempHandler = useCallback(() => {\n    setTemp(temp * 2)\n  }, [temp])\n\n  const onHalfTempHandler = useCallback(\n    (event) => {\n      setTemp(temp / 2)\n    },\n    [temp],\n  )\n\n  const onLengthChangeHandler = useCallback((event) => {\n    const value = +event.target.value\n    if (Number.isNaN(value) || value < 0) return\n    dispatch(onLengthChangeAction(Math.round(value)))\n  }, [])\n\n  const onCellClickHandler = useCallback((event) => {\n    const rowIndex = +event.target.getAttribute('data-row-index')\n    const cellIndex = +event.target.getAttribute('data-cell-index')\n    dispatch(onCellClickAction({ rowIndex, cellIndex }))\n  }, [])\n\n  const onPlayClick = useCallback(() => {\n    // This is \"play audio when user clicked\" workaround to enable playing of particular\n    // Audio instances and being able to play them out of click context. Still buggy.\n    audios[instrument].forEach(audio => {\n      audio.volume = 0\n      audio.load()\n      audio.play()\n      audio.pause()\n    })\n\n    setPlaying(true)\n  }, [instrument])\n\n  const onStopClick = useCallback(() => {\n    setPlaying(false)\n  }, [])\n\n  const activeRowIndex = useMemo(() => {\n    if (!playing) return null\n    return state.playRow === 0 ? state.track.length - 1 : state.playRow - 1\n  }, [playing, state])\n\n  useEffect(() => {\n    if (!playing) return\n    const intervalId = setInterval(() => {\n      dispatch(onPlayNextAction(instrument))\n    }, 60000 / temp)\n    return () => clearInterval(intervalId)\n  }, [temp, playing, instrument])\n\n  return (\n    <div className={cn.root}>\n      <div>\n        <div className={cn.table}>\n          <div className={cn.header}>\n            <div className={cn.annotation}></div>\n            <div className={cn.annotation}>B</div>\n            <div className={cn.annotation}>t</div>\n            <div className={cn.annotation}>S</div>\n          </div>\n          {state.track.map((row, rowIndex) => (\n            <div className={`${cn.row} ${rowIndex === activeRowIndex ? cn.active : ''}`} key={rowIndex}>\n              <div className={cn.annotation}>{rowIndex + 1}</div>\n              {row.map((item, cellIndex) => (\n                <div key={cellIndex} className={`${item ? cn.active : cn.inactive} ${cn.cell}`}>\n                  <div\n                    data-row-index={rowIndex}\n                    data-cell-index={cellIndex}\n                    className={cn.inner}\n                    onClick={onCellClickHandler}/>\n                </div>\n              ))}\n            </div>\n          ))}\n        </div>\n      </div>\n      <div>\n        <div className={cn.input}>\n          <div>Размер</div>\n          <div>\n            <input type=\"text\" value={state.track.length} onChange={onLengthChangeHandler}/>\n          </div>\n        </div>\n        <div className={cn.input}>\n          <div>Темп</div>\n          <div>\n            <input type=\"text\" value={temp} onChange={onTempChangeHandler}/>\n            <button onClick={onDoubleTempHandler}>x2</button>\n            <button onClick={onHalfTempHandler}>/2</button>\n          </div>\n        </div>\n        <div className={cn.input}>\n          <div>Рисунок</div>\n          <div>\n            <input type=\"text\" value={state.signature} onChange={onSignatureChangeHandler}/>\n          </div>\n        </div>\n\n        <div>Инструмент</div>\n        <select className={cn.input} name=\"select\" value={instrument} onChange={onInstrumentChangeHandler}>\n          {Object.keys(audios).map((name) => (\n            <option key={name} value={name}>\n              {name}\n            </option>\n          ))}\n        </select>\n\n        <div className={cn.button}>\n          <button onClick={onPlayClick}>Play</button>\n          <button onClick={onStopClick}>Pause</button>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\n\nReactDOM.render(<App />, document.getElementById('root'))\n\nfunction unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister()\n    })\n  }\n}\n\nunregister()\n"],"sourceRoot":""}